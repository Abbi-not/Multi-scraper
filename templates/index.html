<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Job Scraper</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body {
      background: #f4f4f9;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    h1 {
      text-align: center;
      margin: 30px 0 20px;
      font-weight: bold;
      color: #333;
    }

    .filters {
      text-align: center;
      margin-bottom: 25px;
    }

    .filter-btn {
      border: 2px solid #000;
      background: #fff;
      padding: 6px 14px;
      margin: 0 5px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.2s;
    }

    .filter-btn.active {
      background: #000;
      color: #fff;
    }

    .job-card {
      background: #fff;
      border: 2px solid #000;
      border-radius: 8px;
      margin-bottom: 20px;
      overflow: hidden;
      box-shadow: 4px 4px 0 #000;
      display: flex;
      flex-direction: column;
      height: 100%;
    }

    .window-bar {
      background: #e6e6e6;
      padding: 6px 10px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 2px solid #000;
    }

    .window-buttons {
      display: flex;
      gap: 6px;
    }

    .window-btn {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      border: 1px solid #000;
    }

    .window-btn.red { background: #ff5f56; }
    .window-btn.yellow { background: #ffbd2e; }
    .window-btn.green { background: #27c93f; }

    .job-body {
      padding: 15px;
      flex-grow: 1;
      display: flex;
      flex-direction: column;
    }

    .job-title {
      font-size: 1.2rem;
      font-weight: bold;
      margin-bottom: 5px;
      color: #111;
    }

    .company {
      font-size: 0.95rem;
      color: #555;
      margin-bottom: 10px;
    }

    .job-summary {
      flex-grow: 1;
      font-size: 0.9rem;
      color: #333;
      margin-bottom: 15px;
    }

    .tags {
      margin-bottom: 10px;
    }

    .tag {
      display: inline-block;
      background: #000;
      color: #fff;
      font-size: 0.75rem;
      padding: 3px 8px;
      border-radius: 4px;
      margin-right: 5px;
    }

    .source-badge {
      display: inline-block;
      font-size: 0.7rem;
      padding: 2px 6px;
      background: #eee;
      border: 1px solid #000;
      border-radius: 4px;
      margin-top: 5px;
    }

    .apply-btn {
      align-self: flex-start;
      margin-top: auto;
      text-decoration: none;
      background: #000;
      color: #fff;
      padding: 8px 14px;
      border-radius: 6px;
      font-weight: bold;
      transition: all 0.2s ease-in-out;
    }

    .apply-btn:hover {
      background: #444;
    }

    #load-more {
      display: block;
      margin: 20px auto;
      padding: 10px 20px;
      background: #000;
      color: #fff;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      cursor: pointer;
      box-shadow: 3px 3px 0 #000;
    }

    #load-more:disabled {
      background: #aaa;
      cursor: not-allowed;
      box-shadow: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üåç Remote Jobs</h1>

    <!-- üîπ Filter buttons -->
    <div class="filters">
      <button class="filter-btn active" data-source="all">All</button>
      <button class="filter-btn" data-source="weworkremotely">WeWorkRemotely</button>
      <button class="filter-btn" data-source="remoteok">RemoteOK</button>
      <button class="filter-btn" data-source="remotive">Remotive</button>
      <button class="filter-btn" data-source="trulyremote">TrulyRemote</button>
    </div>

    <div id="job-list" class="row"></div>
    <button id="load-more">Load More</button>
  </div>

  <script>
  let page = 1;
  const perPage = 12;
  const jobList = document.getElementById("job-list");
  const loadMoreBtn = document.getElementById("load-more");
  const filterBtns = document.querySelectorAll(".filter-btn");

  let jobSources = {};
  let allJobs = []; // keep a flat list too
  let activeFilter = "all";

  async function fetchJobs() {
    loadMoreBtn.disabled = true;
    loadMoreBtn.innerText = "Loading...";

    try {
      const res = await fetch(`/api/jobs?page=${page}&per_page=${perPage * 4}`);
      const data = await res.json();
      const jobs = data.jobs;

      if (!jobs || jobs.length === 0) {
        loadMoreBtn.innerText = "No More Jobs";
        loadMoreBtn.disabled = true;
        return;
      }

      jobs.forEach(job => {
        const source = (job.source || "other").toLowerCase();
        if (!jobSources[source]) jobSources[source] = [];
        jobSources[source].push(job);
        allJobs.push(job);
      });

      renderJobs();
      page++;
      loadMoreBtn.disabled = false;
      loadMoreBtn.innerText = "Load More";

    } catch (err) {
      console.error(err);
      loadMoreBtn.innerText = "Error! Try Again";
      loadMoreBtn.disabled = false;
    }
  }

  function renderJobs() {
    jobList.innerHTML = "";

    let jobsToRender = [];
    if (activeFilter === "all") {
      jobsToRender = allJobs;
    } else {
      jobsToRender = jobSources[activeFilter] || [];
    }

    if (jobsToRender.length === 0) {
      jobList.innerHTML = `<p class="text-center">No jobs found for <b>${activeFilter}</b>.</p>`;
      return;
    }

    jobsToRender.slice(0, perPage * page).forEach(job => renderJob(job));
  }

  function renderJob(job) {
    const col = document.createElement("div");
    col.className = "col-md-6 col-lg-4";

    col.innerHTML = `
      <div class="job-card">
        <div class="window-bar">
          <span>${job.source || "Job Portal"}</span>
          <div class="window-buttons">
            <div class="window-btn red"></div>
            <div class="window-btn yellow"></div>
            <div class="window-btn green"></div>
          </div>
        </div>
        <div class="job-body">
          <div class="job-title">${job.title || "Untitled"}</div>
          <div class="company">${job.company || "Unknown Company"}</div>
          <p class="job-summary">${job.summary || "No description available."}</p>
          <div class="tags">
            ${job.location ? `<span class="tag">${job.location}</span>` : ""}
            ${job.type ? `<span class="tag">${job.type}</span>` : ""}
            ${job.salary ? `<span class="tag">${job.salary}</span>` : ""}
          </div>
          <span class="source-badge">Source: ${job.source || "Unknown"}</span>
          <a href="${job.url}" target="_blank" class="apply-btn">Apply Now</a>
        </div>
      </div>
    `;
    jobList.appendChild(col);
  }

  // Filter button events
  filterBtns.forEach(btn => {
    btn.addEventListener("click", () => {
      filterBtns.forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      activeFilter = btn.dataset.source.toLowerCase();
      renderJobs();
    });
  });

  // Initial load
  fetchJobs();
  loadMoreBtn.addEventListener("click", fetchJobs);
</script>

</body>
</html>
